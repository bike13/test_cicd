pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                echo 'æ£€å‡ºä»£ç ...'
                checkout scm
            }
        }
        
        stage('Validate') {
            steps {
                echo 'éªŒè¯æ–‡ä»¶...'
                sh '''
                    echo "æ£€æŸ¥æ–‡ä»¶ç»“æ„..."
                    ls -la
                    
                    echo "æ£€æŸ¥HTMLæ–‡ä»¶..."
                    if [ -f "static/chat.html" ]; then
                        echo "âœ“ HTMLæ–‡ä»¶å­˜åœ¨"
                        if grep -q "Hello World" static/chat.html; then
                            echo "âœ“ Hello Worldå†…å®¹å­˜åœ¨"
                        else
                            echo "âœ— Hello Worldå†…å®¹ä¸å­˜åœ¨"
                            exit 1
                        fi
                    else
                        echo "âœ— HTMLæ–‡ä»¶ä¸å­˜åœ¨"
                        exit 1
                    fi
                '''
            }
        }
        
        stage('Deploy') {
            steps {
                echo 'éƒ¨ç½²æ–‡ä»¶...'
                sh '''
                    echo "åˆ›å»ºéƒ¨ç½²ç›®å½•..."
                    mkdir -p /tmp/hello-world-deploy
                    
                    echo "å¤åˆ¶æ–‡ä»¶..."
                    cp -r static /tmp/hello-world-deploy/
                    
                    echo "éªŒè¯éƒ¨ç½²..."
                    if [ -f "/tmp/hello-world-deploy/static/chat.html" ]; then
                        echo "âœ“ éƒ¨ç½²æˆåŠŸ"
                        echo "ğŸ“ éƒ¨ç½²è·¯å¾„: /tmp/hello-world-deploy/static/chat.html"
                    else
                        echo "âœ— éƒ¨ç½²å¤±è´¥"
                        exit 1
                    fi
                '''
            }
        }
    }
    
    post {
        success {
            echo 'ğŸ‰ éƒ¨ç½²æˆåŠŸï¼'
        }
        failure {
            echo 'âŒ éƒ¨ç½²å¤±è´¥ï¼'
        }
    }
}
